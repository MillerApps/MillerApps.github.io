<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Dns on Rabbit Hole | MillerApps</title>
    <link>//localhost:1313/categories/dns/</link>
    <description>Recent content in Dns on Rabbit Hole | MillerApps</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Sat, 20 Jul 2024 00:00:00 +0000</lastBuildDate><atom:link href="//localhost:1313/categories/dns/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Secure DNS Setup with pfSense, AdGuard Home, and Tailscale</title>
      <link>//localhost:1313/dns-fun/</link>
      <pubDate>Sat, 20 Jul 2024 00:00:00 +0000</pubDate>
      
      <guid>//localhost:1313/dns-fun/</guid>
      <description>&lt;h2 id=&#34;current-setup-overview&#34;&gt;Current Setup Overview&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt;&lt;br&gt;
I am not an expert nor do I claim to be!&lt;br&gt;
I am simply a man who decided to learn more about networking and went down the rabbit hole of DNS and DNS encryption.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This is my personal experience; use it as a starting point for your own explorations.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;My current setup involves the following components and configurations to ensure secure and private DNS resolution:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Client Device to pfSense:&lt;/strong&gt;&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;current-setup-overview&#34;&gt;Current Setup Overview&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt;&lt;br&gt;
I am not an expert nor do I claim to be!&lt;br&gt;
I am simply a man who decided to learn more about networking and went down the rabbit hole of DNS and DNS encryption.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This is my personal experience; use it as a starting point for your own explorations.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;My current setup involves the following components and configurations to ensure secure and private DNS resolution:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Client Device to pfSense:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DNS requests from client devices are sent to pfSense in plain text (for unencrypted, unsupported devices). On devices capable of DNS-over-HTTPS (DoH) or DNS-over-TLS (DoT), full encryption is applied from the client onward. Otherwise, DNS requests remain unencrypted at the client level.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;pfSense to AdGuard Home:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pfSense forwards DNS requests to AdGuard Home using SSL/TLS with the designated certificates (to be created later).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;AdGuard Home:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Processes DNS requests, applying filtering rules.&lt;/li&gt;
&lt;li&gt;Forwards DNS requests to Mullvad’s DNS servers using either DNS-over-HTTPS (DoH) or DNS-over-TLS (DoT).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Tailscale:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Routes DNS traffic through pfSense for mobile devices when off the home network.&lt;/li&gt;
&lt;li&gt;This ensures that DNS queries are encrypted between mobile devices and pfSense, though not necessarily end-to-end.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;dns-request-and-return-route-diagram&#34;&gt;DNS Request and Return Route Diagram&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-mermaid&#34; data-lang=&#34;mermaid&#34;&gt;graph TD
    A[Client Device] --&amp;gt;|1. Sends DNS (Plain, DoH, or DoT: device dependent) request| B[pfSense]
    B --&amp;gt;|2. Forwards DNS request with SSL/TLS| C[AdGuard Home]
    C --&amp;gt;|3. Sends DNS request using DoH/DoT| D[Mullvad DNS Server]
    D --&amp;gt;|4. Returns DNS response| C
    C --&amp;gt;|5. Forwards DNS response with SSL/TLS| B
    B --&amp;gt;|6. Returns DNS response (Plain, DoH, or DoT: device dependent)| A
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;summary-of-security-benefits&#34;&gt;Summary of Security Benefits&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Encryption from pfSense to AdGuard Home:&lt;/strong&gt; DNS queries are encrypted with SSL/TLS.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Encryption from AdGuard Home to Mullvad’s DNS Servers:&lt;/strong&gt; DNS queries are encrypted using DoH or DoT.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Privacy:&lt;/strong&gt; Minimizes logging risks from third-party DNS providers and cell carriers.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ad and Tracker Blocking:&lt;/strong&gt; AdGuard Home blocks ads and trackers at the DNS level.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Consistency:&lt;/strong&gt; The same DNS filtering rules apply both at home and on the go (via a reverse proxy or Tailscale).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;step-by-step-setup-guide&#34;&gt;Step-by-Step Setup Guide&lt;/h2&gt;
&lt;h3 id=&#34;step-1-install-and-configure-adguard-home&#34;&gt;Step 1: Install and Configure AdGuard Home&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Download and Install AdGuard Home:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Automated Install (Linux/Unix/MacOS/FreeBSD/OpenBSD):
&lt;a href=&#34;https://github.com/AdguardTeam/AdGuardHome#automated-install-linuxunixmacosfreebsdopenbsd&#34;&gt;AdGuard Home Automated Install&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Proxmox Helper Script:
&lt;a href=&#34;https://tteck.github.io/Proxmox/#adguard-home-lxc&#34;&gt;Proxmox Helper Script&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bash -c &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;wget -qLO - https://github.com/tteck/Proxmox/raw/main/ct/adguard.sh&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Access the Web Interface:&lt;/strong&gt;&lt;br&gt;
In your web browser, navigate to:&lt;br&gt;
&lt;code&gt;http://&amp;lt;your_server_ip&amp;gt;:3000&lt;/code&gt;&lt;br&gt;
and complete the setup.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;step-2-configure-adguard-home&#34;&gt;Step 2: Configure AdGuard Home&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Access the AdGuard Home Web Interface:&lt;/strong&gt;&lt;br&gt;
Navigate to &lt;code&gt;http://&amp;lt;your_server_ip&amp;gt;:3000&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Set Up Upstream DNS Servers:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Go to &lt;strong&gt;Settings&lt;/strong&gt; → &lt;strong&gt;DNS Settings&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Under &lt;strong&gt;Upstream DNS servers&lt;/strong&gt;, add:
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;https://dns.mullvad.net/dns-query&lt;/code&gt; (for DoH)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tls://dns.mullvad.net&lt;/code&gt; (for DoT)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Configure Encryption:&lt;/strong&gt;&lt;br&gt;
More details can be found in the &lt;a href=&#34;https://github.com/AdguardTeam/AdGuardHome/wiki/Encryption&#34;&gt;AdGuard Home Encryption Wiki&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Go to &lt;strong&gt;Settings&lt;/strong&gt; → &lt;strong&gt;Encryption Settings&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Configure SSL/TLS certificates.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Set up Let&amp;rsquo;s Encrypt certs using Certbot:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo certbot certonly --manual --preferred-challenges&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;dns --preferred-chain&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ISRG Root X1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Follow the instructions provided by Certbot. Provide your domain (and wildcard if needed) during the process.&lt;br&gt;
After completion, you&amp;rsquo;ll receive two files:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fullchain.pem&lt;/code&gt; – PEM-encoded SSL certificate.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;privkey.pem&lt;/code&gt; – PEM-encoded private key.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Either paste the contents into the fields or provide the full file paths, then save and apply.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;step-3-configure-pfsense-for-secure-dns-forwarding&#34;&gt;Step 3: Configure pfSense for Secure DNS Forwarding&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Install the Certificate:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In pfSense, navigate to &lt;strong&gt;System&lt;/strong&gt; → &lt;strong&gt;Cert Manager&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Import your SSL/TLS certificate and private key (simply use &lt;code&gt;cat &amp;lt;path&amp;gt;&lt;/code&gt; to copy the full output contents).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Set Up AdGuard as the DNS Server:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Go to &lt;strong&gt;System&lt;/strong&gt; → &lt;strong&gt;General Setup&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Under DNS Settings, add the IPv4 and (if applicable) IPv6 addresses for AdGuard.&lt;/li&gt;
&lt;li&gt;Save and apply.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Configure the DNS Resolver (Unbound):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Navigate to &lt;strong&gt;Services&lt;/strong&gt; → &lt;strong&gt;DNS Resolver&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Enable the DNS Resolver.&lt;/li&gt;
&lt;li&gt;Leave ports as default.&lt;/li&gt;
&lt;li&gt;Enable SSL/TLS Service.&lt;/li&gt;
&lt;li&gt;Select the certificate installed previously.&lt;/li&gt;
&lt;li&gt;Choose the interfaces to use (e.g., All if unsure).&lt;/li&gt;
&lt;li&gt;Under &lt;strong&gt;DNS Query Forwarding&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;Enable Forwarding Mode.&lt;/li&gt;
&lt;li&gt;Use SSL/TLS for outgoing DNS queries to forwarding servers (this forwards DNS queries to AdGuard via DoT).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Save and apply.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;step-4-configure-tailscale&#34;&gt;Step 4: Configure Tailscale&lt;/h3&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;Enable SSH Access:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;In pfSense, navigate to &lt;strong&gt;System&lt;/strong&gt; → &lt;strong&gt;Advanced&lt;/strong&gt; → &lt;strong&gt;Admin Access&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Under &lt;strong&gt;Secure Shell&lt;/strong&gt;, check &amp;ldquo;Enable Secure Shell&amp;rdquo;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;(Optional) Change the default port from &lt;strong&gt;22&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;From your terminal, connect using:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ssh -p &amp;lt;port-if-changed&amp;gt; &amp;lt;your-admin-name&amp;gt;@&amp;lt;your-pfsense-ip&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Select option &lt;code&gt;8&lt;/code&gt; (Shell) from the pfSense menu.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Run the following to install Tailscale:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pkg add -f https://pkg.freebsd.org/FreeBSD:14:amd64/latest/All/tailscale-1.70.0.pkg
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;(Replace the URL with the latest version if updated; &lt;code&gt;1.70.0&lt;/code&gt; was released on &lt;strong&gt;07/17/24&lt;/strong&gt;.)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;(Optional) Add firewall rules to restrict SSH access from WAN for increased security.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Install Tailscale on pfSense:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Follow the official Tailscale documentation to install it via pfSense’s package manager.&lt;/li&gt;
&lt;li&gt;Go to &lt;strong&gt;System&lt;/strong&gt; → &lt;strong&gt;Package Manager&lt;/strong&gt; → &lt;strong&gt;Available Packages&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Note: At times the available version might lag behind; check &lt;a href=&#34;https://forum.netgate.com/topic/174525/how-to-update-to-the-latest-tailscale-version/60&#34;&gt;this forum discussion&lt;/a&gt; for updates.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Configure Tailscale to Use pfSense as DNS:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Navigate to &lt;strong&gt;VPN&lt;/strong&gt; → &lt;strong&gt;Tailscale&lt;/strong&gt; → &lt;strong&gt;Settings&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Under DNS, uncheck &amp;ldquo;Accept DNS&amp;rdquo; (if checked) to prevent Tailscale from overriding your DNS settings.&lt;/li&gt;
&lt;li&gt;Under Routing, uncheck &amp;ldquo;Accept Subnet Routes&amp;rdquo; if it’s enabled.
&lt;ul&gt;
&lt;li&gt;Add the IP of pfSense (for example, &lt;code&gt;192.168.1.1/32&lt;/code&gt;) to Advertised Routes.&lt;/li&gt;
&lt;li&gt;Optionally, add AdGuard&amp;rsquo;s IP if you wish to access its admin panel remotely.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Save and apply the changes.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Approve Routes and Configure DNS in Tailscale Admin:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Visit &lt;a href=&#34;https://login.tailscale.com/admin/machines&#34;&gt;Tailscale’s Admin Console&lt;/a&gt;, select your pfSense machine.&lt;/li&gt;
&lt;li&gt;Under the “Subnets” section, approve the awaiting routes.&lt;/li&gt;
&lt;li&gt;In the “DNS” tab, enable &amp;ldquo;override local DNS&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;Add a custom nameserver pointing to your advertised pfSense IP.&lt;/li&gt;
&lt;li&gt;Optionally, disable key expiry by selecting the three vertical dots (ellipsis) next to your pfSense machine and opting for &amp;ldquo;Disable key expiry&amp;rdquo;. More details can be found &lt;a href=&#34;https://tailscale.com/kb/1028/key-expiry?q=key&#34;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Install Tailscale on Mobile Devices:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Download and install the Tailscale app on your mobile devices.&lt;/li&gt;
&lt;li&gt;Log in with your Tailscale account and enable the Tailscale DNS settings.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;optional-step-5-configure-clients&#34;&gt;Optional Step 5: Configure Clients&lt;/h3&gt;
&lt;h4 id=&#34;configure-macos--ios-for-dohdot&#34;&gt;Configure macOS &amp;amp; iOS for DoH/DoT&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Using Built-in Support (macOS 11+ and iOS 14+):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Refer to the following resources:
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/paulmillr/encrypted-dns&#34;&gt;paulmillr/encrypted-dns on GitHub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mullvad.net/en/blog/profiles-to-configure-our-encrypted-dns-on-apple-devices&#34;&gt;Mullvad&amp;rsquo;s Profiles for Encrypted DNS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.quad9.net/news/blog/ios-mobile-provisioning-profiles&#34;&gt;Quad9 iOS Mobile Provisioning Profiles&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Using AdGuard Profiles:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Under &lt;strong&gt;Setup Guide&lt;/strong&gt; → &lt;strong&gt;DNS Privacy&lt;/strong&gt;, configure a profile using a hostname (e.g., &lt;code&gt;adguard.&amp;lt;your-domain&amp;gt;&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;Refer to the &lt;a href=&#34;https://github.com/AdguardTeam/AdGuardHome/wiki/Clients#clientid&#34;&gt;AdGuard Teams documentation on ClientIDs&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Alternative: pfSense Profile Configuration:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a configuration profile pointing to pfSense instead of AdGuard using &lt;a href=&#34;https://developer.apple.com/documentation/devicemanagement/dnssettings&#34;&gt;Apple&amp;rsquo;s DNS profile docs&lt;/a&gt; or an &lt;a href=&#34;https://dns.notjakob.com/index.html&#34;&gt;online tool&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Note: This setup works only on your home network unless paired with Tailscale. Do not reverse proxy pfSense.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Caveats with Profiles:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Profiles without a reverse proxy will only work on your Home Network. With Tailscale, encrypted DNS is still maintained via the VPN tunnel to pfSense.&lt;/li&gt;
&lt;li&gt;If using an AdGuard profile, the VPN bypasses pfSense, but round-trip encryption remains intact.&lt;/li&gt;
&lt;li&gt;For a signed profile, use your Apple developer account; more info is available &lt;a href=&#34;https://support.apple.com/guide/apple-configurator-mac/create-and-edit-configuration-profiles-pmd85719196/mac&#34;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;android&#34;&gt;Android&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Android 9+ supports DNS-over-TLS natively. To configure, go to:&lt;br&gt;
&lt;strong&gt;Settings&lt;/strong&gt; → &lt;strong&gt;Network &amp;amp; internet&lt;/strong&gt; → &lt;strong&gt;Advanced&lt;/strong&gt; → &lt;strong&gt;Private DNS&lt;/strong&gt; and enter your domain name.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;windows&#34;&gt;Windows&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 Build 19628 and later support DNS-over-HTTPS natively.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;This setup ensures that DNS requests remain encrypted and private between pfSense and AdGuard Home, and from AdGuard Home to Mullvad’s DNS servers. Although client-to-pfSense queries may not always be encrypted, using Tailscale secures connections for mobile devices when away from home. By leveraging pfSense, AdGuard Home, and Tailscale, you&amp;rsquo;ve built a robust and secure DNS resolution process.&lt;/p&gt;
&lt;p&gt;Is this the ultimate solution? Probably not—it&amp;rsquo;s the framework I built while learning about networking. I hope you enjoy this journey down the rabbit hole with me. Until next time, happy exploring!&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;em&gt;Open to suggestions or additional insights on any weak points!&lt;/em&gt;&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>

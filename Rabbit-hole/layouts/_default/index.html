{{ define "main" }}
  {{ if .Content }}
    <div class="index-content {{ if .Params.framed -}}framed{{- end -}}">
      {{ .Content }}
    </div>
  {{ end }}
  <div class="posts">
    {{ $isntDefault := not (or (eq (trim $.Site.Params.contentTypeName " ") "posts") (eq (trim $.Site.Params.contentTypeName " ") "")) }}
    {{ $contentTypeName := cond $isntDefault (string $.Site.Params.contentTypeName) "posts" }}

    {{ $PageContext := . }}
    {{ if .IsHome }}
      {{ $PageContext = .Site }}
    {{ end }}
    {{ $paginator := .Paginate (where $PageContext.RegularPages "Type" $contentTypeName) }}
    {{ range $paginator.Pages }}
      <article class="post on-list">
        {{ $file := printf "%s.md" (urlize .Title) }}
        {{ $author := .Params.Author }}
        {{ $hasAuthor := $author }}
        {{ $hasDate := .Date }}
        {{ $user := (default "user" $.Site.Params.owner) | lower }}
        {{ $host := "rabbit-hole" }}
        {{ $path := printf "~/post/%s" (urlize .Title) }}
        <div class="post-prompt">
          <div class="prompt-line prompt-line--top">
            <span class="prompt-lead prompt-lead--top">╭─</span>
            <span class="prompt-left">{{ $user }}@{{ $host }}:{{ $path }}</span>
            <span class="prompt-fill" aria-hidden="true"></span>
            <span class="prompt-right">
              {{- if $hasDate -}}
                <span class="prompt-label">at</span>
                <span class="prompt-value">{{- partial "post-date" . -}}</span>
              {{- end -}}
              {{- if and $hasDate $hasAuthor -}}
                <span class="prompt-divider">·</span>
              {{- end -}}
              {{- if $hasAuthor -}}
                <span class="prompt-label">by</span>
                <span class="prompt-value">{{ $author }}</span>
              {{- end -}}
            </span>
          </div>
          <div class="prompt-line prompt-line--lead">
            <span class="prompt-lead">╰─❯</span>
            <a class="prompt-command" href="{{ .Permalink }}">
              <span class="prompt-command__verb">cat</span>
              <span class="prompt-command__file">{{ $file }}</span>
              <span class="prompt-cursor" aria-hidden="true">▊</span>
            </a>
          </div>
        </div>

        {{ if .Params.tags }}
          <span class="post-tags">
            {{ range .Params.tags }}
            <a href="{{ (urlize (printf "tags/%s/" . )) | absLangURL }}">
              {{- . -}}
            </a>
            {{ end }}
          </span>
        {{ end }}

        {{ partial "cover.html" . }}

        <div class="post-content post-content--summary">
          {{ $summary := "" }}
          {{ if .Description }}
            {{ $summary = .Description | plainify }}
          {{ else }}
            {{ $summary = .Summary | plainify }}
          {{ end }}
          <p>{{ $summary | truncate 120 }}</p>
        </div>
      </article>
    {{ end }}

    {{ partial "pagination.html" . }}
  </div>
{{ end }}
